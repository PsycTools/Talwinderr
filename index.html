<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Infarno Tools</title>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Babel for JSX transformation in browser -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Tailwind Configuration -->
<script>
  // Process Shim for Environment Variables
  window.process = { 
    env: { 
      NODE_ENV: 'production',
      // INSERT YOUR GOOGLE GEMINI API KEY BELOW inside the quotes
      API_KEY: '' 
    } 
  };

  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        fontFamily: {
          sans: ['Inter', 'sans-serif'],
          mono: ['JetBrains Mono', 'monospace'],
        },
        colors: {
          background: '#0B0B0D',
          surface: '#151518',
          border: '#27272A',
          primary: '#A855F7', // Purple/Magenta
          secondary: '#06B6D4', // Cyan
          text: {
            main: '#FFFFFF',
            muted: '#A1A1AA', // Zinc 400
          }
        },
        animation: {
          'blob': 'blob 10s infinite',
          'shimmer': 'shimmer 2s linear infinite',
          'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        },
        keyframes: {
          blob: {
            '0%': { transform: 'translate(0px, 0px) scale(1)' },
            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
            '100%': { transform: 'translate(0px, 0px) scale(1)' },
          },
          shimmer: {
            '0%': { backgroundPosition: '200% 0' },
            '100%': { backgroundPosition: '-200% 0' }
          }
        }
      },
    },
  }
</script>

<!-- Custom CSS -->
<style>
  html {
    scroll-behavior: smooth;
  }
  body {
    background-color: #0B0B0D;
    color: #FFFFFF;
    overflow-x: hidden;
  }
  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #0B0B0D; 
  }
  ::-webkit-scrollbar-thumb {
    background: #27272A; 
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #3F3F46; 
  }
  .glass-panel {
    background: rgba(21, 21, 24, 0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.08);
  }
  .bg-size-200 {
    background-size: 200% 100%;
  }
</style>

<!-- Import Map for Modules -->
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "react-router-dom": "https://esm.sh/react-router-dom@6.22.3",
    "framer-motion": "https://esm.sh/framer-motion@11.0.8",
    "lucide-react": "https://esm.sh/lucide-react@0.344.0",
    "@google/genai": "https://esm.sh/@google/genai@0.1.1",
    "jspdf": "https://esm.sh/jspdf@2.5.1"
  }
}
</script>
</head>
<body>
<div id="root"></div>
<script type="text/babel" data-type="module">
  import React, { useState, useEffect, createContext, useContext, useCallback, useRef } from 'react';
  import ReactDOM from 'react-dom/client';
  import { HashRouter, Routes, Route, useLocation, Link, useParams } from 'react-router-dom';
  import { motion, AnimatePresence } from 'framer-motion';
  import { 
    Code2, FileJson, PenTool, Mail, Search, ShieldCheck, Zap, 
    Image as ImageIcon, Mic, Speaker, QrCode, Lock, Eraser, 
    FileText, User, MessageSquare, Copy, Crop, Minimize2, 
    Type, Calculator, StickyNote, Link as LinkIcon, Braces,
    Globe, Languages, Palette, Smile, BookOpen, BrainCircuit,
    Heart, Hash, Tag, UserCircle, Lightbulb, Briefcase, 
    ShoppingBag, RefreshCw, Target, Fingerprint, Rocket,
    Camera, Layers, Monitor, Video, Sparkles, AlertTriangle, 
    Menu, X, Flame, ArrowUpRight, Check, Download, Terminal, 
    History, Trash2, RotateCcw, Music, Clock, ChevronRight, 
    AlertCircle, Upload, Wand2, HelpCircle, CheckCircle2, 
    ArrowRight, Github, Wallet, CreditCard, ChevronLeft, Unlock
  } from 'lucide-react';
  import { GoogleGenAI } from '@google/genai';
  import { jsPDF } from 'jspdf';

  // --- TYPES & ENUMS ---
  const ToolCategory = {
    DEVELOPER: 'Developer',
    WRITING: 'Writing',
    PRODUCTIVITY: 'Productivity',
    DESIGN: 'Design',
    SEO: 'SEO',
    MEDIA: 'Media',
    UTILITY: 'Utility'
  };

  const InputType = {
    TEXTAREA: 'TEXTAREA',
    TEXT_INPUT: 'TEXT_INPUT',
    SELECT: 'SELECT',
    NUMBER: 'NUMBER',
    FILE: 'FILE',
    BOOLEAN: 'BOOLEAN'
  };

  // --- SERVICES: EXTERNAL ---
  const SHRINK_EARN_API_KEY = '2b431f418dc08618fd3bce68255371f2f99534f6';
  const CUTY_API_KEY = 'a8071f7b4c386a1e113d8dde00e5a48cd3a5feed';
  const APY_HUB_TOKEN = '1c92a808-3e18-4765-b721-d89ba5333831'; 
  const MAXELPAY_MERCHANT_ID = '0829iDbhA5Fg9zzKMuZewkYKoUNhVW8c';
  const MAXELPAY_API_KEY = 'xHxFYjAgKOIo3etgUCRLVczHA5To4nSO';

  const extractColorPalette = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "No image provided";
      return new Promise((resolve) => {
          const img = new Image();
          img.src = fileBase64;
          img.crossOrigin = "Anonymous";
          img.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              if(!ctx) { resolve("Canvas error"); return; }
              canvas.width = img.width;
              canvas.height = img.height;
              ctx.drawImage(img, 0, 0);
              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
              const colorCounts = {};
              for (let i = 0; i < imageData.length; i += 40) {
                  const r = imageData[i];
                  const g = imageData[i + 1];
                  const b = imageData[i + 2];
                  const key = `${Math.round(r/10)*10},${Math.round(g/10)*10},${Math.round(b/10)*10}`;
                  colorCounts[key] = (colorCounts[key] || 0) + 1;
              }
              const sortedColors = Object.entries(colorCounts)
                  .sort((a, b) => b[1] - a[1])
                  .slice(0, 5)
                  .map(([key]) => {
                      const [r, g, b] = key.split(',');
                      return `rgb(${r}, ${g}, ${b})`;
                  });
              const html = `<div style="display:flex; gap:10px; flex-wrap:wrap;">
                  ${sortedColors.map(c => `
                      <div style="flex:1; min-width:80px; height:100px; background:${c}; border-radius:8px; display:flex; align-items:center; justify-content:center; flex-direction:column; box-shadow:0 4px 6px rgba(0,0,0,0.3);">
                          <span style="background:rgba(0,0,0,0.5); color:white; padding:2px 6px; border-radius:4px; font-size:10px; font-family:monospace;">${rgbToHex(c)}</span>
                      </div>
                  `).join('')}
              </div>`;
              resolve(html);
          };
          img.onerror = () => resolve("Error processing image.");
      });
  };

  function rgbToHex(rgb) {
      const [r, g, b] = rgb.match(/\d+/g).map(Number);
      return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
  }

  const textToPdf = async (inputs) => {
      try {
          const doc = new jsPDF();
          const text = inputs.text || "";
          const lines = doc.splitTextToSize(text, 180);
          doc.text(lines, 10, 10);
          return doc.output('datauristring');
      } catch (e) {
          return "Error generating PDF. Please ensure text is valid. " + e.message;
      }
  };

  const formatJson = async (inputs) => {
      try {
          const json = JSON.parse(inputs.json);
          return JSON.stringify(json, null, 2);
      } catch (e) {
          return "Invalid JSON: " + e.message;
      }
  };

  const wordCounter = async (inputs) => {
      const text = inputs.text || "";
      const words = text.trim() === "" ? 0 : text.trim().split(/\s+/).length;
      const chars = text.length;
      const charsNoSpace = text.replace(/\s/g, '').length;
      return `Words: ${words}\nCharacters: ${chars}\nCharacters (no spaces): ${charsNoSpace}`;
  };

  const imageCompressor = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "No image";
      return new Promise((resolve) => {
          const img = new Image();
          img.src = fileBase64;
          img.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              canvas.width = img.width;
              canvas.height = img.height;
              ctx?.drawImage(img, 0, 0);
              resolve(canvas.toDataURL('image/jpeg', 0.5));
          };
          img.onerror = () => resolve("Error processing image.");
      });
  };

  const imageCropper = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "No image";
      return new Promise((resolve) => {
          const img = new Image();
          img.src = fileBase64;
          img.onload = () => {
              const canvas = document.createElement('canvas');
              const size = Math.min(img.width, img.height);
              canvas.width = size;
              canvas.height = size;
              const ctx = canvas.getContext('2d');
              ctx?.drawImage(img, (img.width - size) / 2, (img.height - size) / 2, size, size, 0, 0, size, size);
              resolve(canvas.toDataURL());
          };
           img.onerror = () => resolve("Error processing image.");
      });
  };

  const generateQrCode = async (inputs) => {
    const data = encodeURIComponent(inputs.text || 'https://example.com');
    return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${data}`;
  };

  const generatePassword = async (inputs) => {
    const length = parseInt(inputs.length) || 12;
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";
    let retVal = "";
    for (let i = 0, n = charset.length; i < length; ++i) {
      retVal += charset.charAt(Math.floor(Math.random() * n));
    }
    return retVal;
  };

  const shortenUrl = async (inputs) => {
      const longUrl = inputs.url;
      const provider = inputs.provider || 'ShrinkEarn';
      const alias = inputs.alias || '';
      if (!longUrl) return "Please enter a URL.";
      let endpoint = '';
      if (provider === 'Cuty.io') {
          endpoint = `https://cuty.io/api?api=${CUTY_API_KEY}&url=${encodeURIComponent(longUrl)}`;
          if (alias) endpoint += `&alias=${encodeURIComponent(alias)}`;
      } else {
          endpoint = `https://shrinkearn.com/api?api=${SHRINK_EARN_API_KEY}&url=${encodeURIComponent(longUrl)}`;
      }
      try {
          const response = await fetch(endpoint);
          if (!response.ok) return `Error contacting ${provider} service. (Network)`;
          const data = await response.json();
          if (data.status === 'success' || data.shortenedUrl) {
               return data.shortenedUrl;
          } else {
               return "Error: " + (data.message || "Failed to shorten. Check URL or Alias availability.");
          }
      } catch (e) {
           return `Network Error (CORS). Verify URL and try again.`;
      }
  };

  const saveNote = async (inputs) => {
      const title = inputs.title || "Untitled";
      const content = inputs.content || "";
      const key = `infarno_note_${Date.now()}`;
      localStorage.setItem(key, JSON.stringify({ title, content, date: new Date().toISOString() }));
      return `Note '${title}' saved to local storage!`;
  };

  const unitConverter = async (inputs) => {
      const val = parseFloat(inputs.value);
      const type = inputs.type; 
      if (isNaN(val)) return "Invalid number";
      switch(type) {
          case 'c_to_f': return `${val}째C = ${(val * 9/5 + 32).toFixed(2)}째F`;
          case 'f_to_c': return `${val}째F = ${((val - 32) * 5/9).toFixed(2)}째C`;
          case 'kg_to_lbs': return `${val}kg = ${(val * 2.20462).toFixed(2)}lbs`;
          case 'lbs_to_kg': return `${val}lbs = ${(val / 2.20462).toFixed(2)}kg`;
          case 'm_to_ft': return `${val}m = ${(val * 3.28084).toFixed(2)}ft`;
          default: return "Unknown conversion";
      }
  };

  const removeBackground = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "Please upload an image.";
      try {
          const res = await fetch(fileBase64);
          const blob = await res.blob();
          const formData = new FormData();
          formData.append('image', blob, 'image.png');
          const response = await fetch('https://api.apyhub.com/processor/image-remove-background/file', {
              method: 'POST',
              headers: { 'apy-token': APY_HUB_TOKEN },
              body: formData
          });
          if (!response.ok) {
              const err = await response.text();
              throw new Error(`API Error: ${response.status} ${err}`);
          }
          const resultBlob = await response.blob();
          return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onloadend = () => resolve(reader.result);
              reader.onerror = reject;
              reader.readAsDataURL(resultBlob);
          });
      } catch (error) {
          return `Background Removal Error: ${error.message}. Check API Key quotas.`;
      }
  };

  const createMaxelPayOrder = async (amount) => {
      try {
          const response = await fetch('https://maxelpay.com/api/create_order', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
              body: JSON.stringify({
                  merchant_id: MAXELPAY_MERCHANT_ID,
                  api_key: MAXELPAY_API_KEY,
                  amount: amount,
                  currency: 'USD',
                  title: 'Infarno Donation',
                  description: 'Support open source development'
              })
          });
          if (!response.ok) {
              const errText = await response.text();
              throw new Error(`Gateway returned status ${response.status}: ${response.statusText}`);
          }
          const data = await response.json();
          if (data.status === 'error') throw new Error(data.message || "Payment Gateway Error");
          const url = data.url || data.payment_url || data.link;
          if (!url) throw new Error("No payment URL received in response.");
          return url;
      } catch (e) {
          console.error("MaxelPay Integration Error:", e);
          if (e instanceof TypeError && e.message.includes('Failed to fetch')) {
               throw new Error("Network/CORS Error: The payment gateway blocked the request from the browser.");
          }
          throw e;
      }
  };

  // --- SERVICES: HUGGING FACE ---
  const HF_TOKEN = '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';
  async function queryHF(model, data, contentType = 'application/json') {
    const response = await fetch(
      `https://api-inference.huggingface.co/models/${model}`,
      {
        headers: {
          Authorization: `Bearer ${HF_TOKEN}`,
          "Content-Type": contentType,
        },
        method: "POST",
        body: data,
      }
    );
    if (!response.ok) {
        const err = await response.text();
        if (response.status === 503) {
            throw new Error("Model is currently loading or busy. Please try again in 30 seconds.");
        }
        throw new Error(`HF API Error: ${err}`);
    }
    return response;
  }

  const speechToText = async (inputs) => {
      const fileBase64 = inputs.audio;
      if (!fileBase64) return "Please upload an audio file.";
      try {
          const res = await fetch(fileBase64);
          const blob = await res.blob();
          const response = await queryHF("openai/whisper-large-v3", blob, "application/octet-stream");
          const result = await response.json();
          return result.text || "No speech detected.";
      } catch (error) {
          return `STT Error: ${error.message}`;
      }
  };

  const imageCaption = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "Please upload an image.";
      try {
          const res = await fetch(fileBase64);
          const blob = await res.blob();
          const response = await queryHF("Salesforce/blip-image-captioning-large", blob, "application/octet-stream");
          const result = await response.json();
          return result[0]?.generated_text || "No caption generated.";
      } catch (error) {
          return `Caption Error: ${error.message}`;
      }
  };

  const ocrImage = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "Please upload an image.";
      try {
          const res = await fetch(fileBase64);
          const blob = await res.blob();
          const response = await queryHF("microsoft/trocr-base-printed", blob, "application/octet-stream");
          const result = await response.json();
          return result[0]?.generated_text || "No text found.";
      } catch (error) {
          return `OCR Error: ${error.message}`;
      }
  };

  const textToSpeech = async (inputs) => {
      const text = inputs.text;
      if (!text) return "Please enter text.";
      try {
          const response = await queryHF("facebook/mms-tts-eng", JSON.stringify({ inputs: text }), "application/json");
          const resultBlob = await response.blob();
          return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onloadend = () => resolve(reader.result);
              reader.onerror = reject;
              reader.readAsDataURL(resultBlob);
          });
      } catch (error) {
          return `TTS Error: ${error.message}`;
      }
  };

  const imageToAnime = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "Please upload an image.";
      try {
          const res = await fetch(fileBase64);
          const blob = await res.blob();
          const response = await queryHF("timbrooks/instruct-pix2pix", blob, "application/octet-stream");
          const resultBlob = await response.blob();
          return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onloadend = () => resolve(reader.result);
              reader.onerror = reject;
              reader.readAsDataURL(resultBlob);
          });
      } catch (error) {
          return `Anime Conversion Error: ${error.message}.`;
      }
  };

  const imageUpscale = async (inputs) => {
      const fileBase64 = inputs.image;
      if (!fileBase64) return "Please upload an image.";
      try {
           const res = await fetch(fileBase64);
           const blob = await res.blob();
           const response = await queryHF("stabilityai/stable-diffusion-x4-upscaler", blob, "application/octet-stream");
           const resultBlob = await response.blob();
           return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onloadend = () => resolve(reader.result);
              reader.onerror = reject;
              reader.readAsDataURL(resultBlob);
          });
      } catch (error) {
           return `Upscaling Error: ${error.message}`;
      }
  };

  // --- SERVICES: GEMINI ---
  // Initialize Gemini with Shimmed Process Env
  const ai = new GoogleGenAI({ apiKey: process.env.API_KEY || '' });

  const generateContent = async (modelId, prompt, systemInstruction) => {
    try {
      if (!process.env.API_KEY) throw new Error("API Key missing. Please edit index.html and add your Gemini API Key.");
      const response = await ai.models.generateContent({
        model: modelId,
        contents: prompt,
        config: {
          systemInstruction: systemInstruction,
          temperature: 0.7,
        }
      });
      return response.text || "No content generated.";
    } catch (error) {
      console.error("Gemini API Error:", error);
      return `Error: ${error.message}.`;
    }
  };

  const generateImage = async (inputs) => {
    try {
      if (!process.env.API_KEY) throw new Error("API Key missing.");
      const prompt = inputs.prompt || "A futuristic landscape";
      const response = await ai.models.generateContent({
        model: 'gemini-2.5-flash-image',
        contents: { parts: [{ text: prompt }] },
        config: { imageConfig: { aspectRatio: "1:1" } }
      });
      for (const part of response.candidates?.[0]?.content?.parts || []) {
        if (part.inlineData) {
          return `data:image/png;base64,${part.inlineData.data}`;
        }
      }
      return "Failed to generate image. Try a different prompt.";
    } catch (error) {
      return `Error generating image: ${error.message}`;
    }
  };

  const complexTextTask = async (inputs, taskType) => {
      let systemInstruction = "";
      let prompt = "";
      const model = 'gemini-2.5-flash'; 

      switch(taskType) {
          case 'CHAT':
              systemInstruction = "You are Infarno AI, a helpful, futuristic, and intelligent assistant.";
              prompt = inputs.message;
              break;
          case 'DEBUG':
              systemInstruction = "You are an expert code debugger. Analyze the code, find bugs, explain them, and provide the fixed code. Explain your changes clearly.";
              prompt = `Debug this code:\n${inputs.code}\n\nContext/Error: ${inputs.context || "None"}`;
              break;
          case 'SUMMARIZE':
              systemInstruction = "You are an expert summarizer. Create a concise, bullet-point summary of the provided text/transcript.";
              prompt = `Summarize this text:\n${inputs.text}`;
              break;
          case 'BLOG':
              systemInstruction = "You are a professional SEO blog writer. Write a comprehensive, engaging blog post with a catchy title, introduction, body paragraphs, and conclusion.";
              prompt = `Write a blog post about: ${inputs.topic}\nTarget Audience: ${inputs.audience || 'General'}\nTone: ${inputs.tone || 'Informative'}`;
              break;
          case 'EMAIL_RESUME':
               if (inputs.type === 'Resume') {
                   systemInstruction = "You are a professional career coach and resume writer. Create a structured resume based on the provided details.";
                   prompt = `Create a professional resume for:\n${inputs.details}`;
               } else {
                   systemInstruction = "You are a professional copywriter. Write effective emails.";
                   prompt = `Write a ${inputs.tone || 'professional'} email.\nTo: ${inputs.recipient || '[Name]'}\nTopic: ${inputs.details}`;
               }
               break;
          case 'TRANSLATE':
              systemInstruction = "You are a professional translator. Translate the text accurately while preserving the original tone.";
              prompt = `Translate the following text into ${inputs.language}:\n\n${inputs.text}`;
              break;
          case 'FLASHCARDS':
              systemInstruction = "You are a study aid generator. Convert the notes into a set of Q&A flashcards.";
              prompt = `Create flashcards from these notes:\n${inputs.text}`;
              break;
          case 'PDF_CLEAN':
              systemInstruction = "You are a text processing engine. Clean up the provided text, remove formatting artifacts, and summarize the key points.";
              prompt = `Clean and summarize this extracted text:\n${inputs.text}`;
              break;
          case 'PROMPT_GEN':
              systemInstruction = "You are a prompt engineer. Refine the user's idea into a highly detailed, optimized prompt for Large Language Models.";
              prompt = `Optimize this prompt idea:\n${inputs.idea}`;
              break;
          case 'SEO':
              systemInstruction = "You are an SEO expert. Generate an optimized title (max 70 chars) and meta description (120-160 chars).";
              prompt = `Generate SEO assets for this topic/content:\n${inputs.text}\n\nOutput format:\nTitle: ...\nMeta Description: ...`;
              break;
          case 'MEME_TEXT':
              systemInstruction = "You are a masterful internet memer. Generate a funny, witty, top-text/bottom-text style caption for a meme.";
              prompt = `Generate a funny meme caption.${inputs.context ? `\nImage Context: ${inputs.context}` : ''}\nTopic/Theme: ${inputs.topic || 'General'}`;
              break;
          case 'EMOTION':
              systemInstruction = "You are a sentiment analysis engine. Detect the primary emotions and tone in the text.";
              prompt = `Analyze the emotion and tone of this text:\n"${inputs.text}"`;
              break;
          case 'STORY':
              systemInstruction = "You are a creative fiction writer. Write a story with vivid details and compelling characters.";
              prompt = `Write a ${inputs.genre || 'General'} story about: ${inputs.topic}. Length: ${inputs.length || 'Medium'}`;
              break;
          case 'QUIZ':
              systemInstruction = "You are a teacher. Generate a multiple-choice quiz based on the text provided. Include the answer key at the end.";
              prompt = `Generate 5 quiz questions based on this text:\n${inputs.text}`;
              break;
          case 'HASHTAGS':
              systemInstruction = "You are a social media growth expert. Generate a list of 30-40 highly relevant, viral hashtags. Categorize them into three groups: High Reach (1M+ posts), Medium Reach (100k-1M posts), and Niche/Specific (under 100k posts).";
              prompt = `Generate hashtags for ${inputs.platform} about: ${inputs.topic}.`;
              break;
          case 'BLOG_IDEAS':
              systemInstruction = "You are a content strategist. Generate 20 unique, engaging blog post topics relevant to the niche. Include a brief one-sentence hook for each.";
              prompt = `Generate blog ideas for the niche: ${inputs.niche}`;
              break;
          case 'SOCIAL_CAPTION':
              systemInstruction = "You are a social media manager. Generate 3 caption options: Short (one liner), Medium (engaging paragraph), and Long (storytelling/detailed). Add emojis.";
              prompt = `Write ${inputs.mood || 'engaging'} captions for ${inputs.platform} about: ${inputs.topic}`;
              break;
          case 'RESUME_AUDIT':
              systemInstruction = "You are an ATS (Applicant Tracking System) expert. Audit the provided resume text. Identify missing keywords, formatting issues, and suggest improvements to pass ATS filters.";
              prompt = `Audit this resume text for ATS compatibility:\n${inputs.resume_text}`;
              break;
          case 'KEYWORD_CLUSTER':
              systemInstruction = "You are an SEO specialist. Group the provided keywords into semantic clusters based on search intent and topic similarity.";
              prompt = `Cluster these keywords:\n${inputs.keywords}`;
              break;
          case 'YT_TAGS':
              systemInstruction = "You are a YouTube SEO expert. Generate a comma-separated list of optimized video tags.";
              prompt = `Generate tags for a video titled "${inputs.title}".\nDescription: ${inputs.description}`;
              break;
          case 'BIO':
              systemInstruction = "You are a personal branding expert. Write a short, engaging, and impactful social media bio.";
              prompt = `Write a ${inputs.vibe} bio for ${inputs.platform}.\nAbout: ${inputs.about}`;
              break;
          case 'SLOGAN':
              systemInstruction = "You are a creative marketing copywriter. Generate catchy, memorable slogans and taglines.";
              prompt = `Generate 10 slogans for a brand named "${inputs.brand}".\nDescription: ${inputs.description}`;
              break;
          case 'DOMAIN':
              systemInstruction = "You are a naming specialist. Generate creative, available, and brandable domain name ideas.";
              prompt = `Generate 15 domain name ideas based on these keywords: ${inputs.keywords}.\nPreferred Extension: ${inputs.extension}`;
              break;
          case 'JOB_DESC':
              systemInstruction = "You are an HR specialist. Write a structured job description including responsibilities and requirements.";
              prompt = `Write a job description for a ${inputs.role}.\nRequired Skills: ${inputs.skills}`;
              break;
          case 'INTERVIEW':
              systemInstruction = "You are a hiring manager. Generate technical and behavioral interview questions.";
              prompt = `Generate 10 interview questions for a ${inputs.level} ${inputs.role} position.`;
              break;
          case 'COVER_LETTER':
              systemInstruction = "You are a career coach. Write a persuasive cover letter.";
              prompt = `Write a cover letter for the role of ${inputs.role} at ${inputs.company}.\nMy Experience: ${inputs.experience}`;
              break;
          case 'PRODUCT_DESC':
              systemInstruction = "You are an e-commerce copywriter. Write a persuasive, SEO-friendly product description.";
              prompt = `Write a product description for "${inputs.product}".\nFeatures: ${inputs.features}`;
              break;
          case 'REWRITE':
              systemInstruction = "You are a professional editor. Rewrite the text to match the requested goal.";
              prompt = `Rewrite the following text.\nGoal: ${inputs.goal}\n\nText:\n${inputs.text}`;
              break;
          case 'STARTUP':
              systemInstruction = "You are a venture capitalist and innovator. Generate unique, viable startup ideas.";
              prompt = `Generate 3 unique startup ideas for the ${inputs.industry} industry. Include the problem, solution, and monetization strategy.`;
              break;
          default:
              return "Invalid task type.";
      }
      return await generateContent(model, prompt, systemInstruction);
  };

  // --- CONSTANTS ---
  const memeGeneratorHandler = async (inputs) => {
      let context = inputs.context || "";
      if (inputs.image && !context) {
          try {
              const caption = await imageCaption(inputs);
              context = caption;
          } catch (e) {
              console.error("Auto-caption failed, proceeding without context");
          }
      }
      return complexTextTask({ ...inputs, context }, 'MEME_TEXT');
  };

  const TOOLS = [
    {
      id: 'ai-chat',
      name: 'AI Chat Assistant',
      tagline: 'ASK ANYTHING',
      description: 'Smart AI assistant powered by Gemini 2.5.',
      category: ToolCategory.PRODUCTIVITY,
      icon: MessageSquare,
      inputs: [{ id: 'message', label: 'Your Question', type: InputType.TEXTAREA, placeholder: 'How do I...' }],
      customHandler: (i) => complexTextTask(i, 'CHAT')
    },
    {
      id: 'image-gen',
      name: 'AI Image Generator',
      tagline: 'TEXT TO IMAGE',
      description: 'Create high-resolution images from text descriptions.',
      category: ToolCategory.MEDIA,
      icon: ImageIcon,
      inputs: [
          { id: 'prompt', label: 'Image Description', type: InputType.TEXTAREA, placeholder: 'A cyberpunk city at night...' },
          { id: 'style', label: 'Style', type: InputType.SELECT, options: ['Realistic', 'Anime', '3D Render', 'Oil Painting', 'Cyberpunk'] }
      ],
      customHandler: (i) => generateImage({ ...i, prompt: `${i.style} style: ${i.prompt}` })
    },
    {
      id: 'code-debug',
      name: 'Code Debugger',
      tagline: 'FIX BUGS FAST',
      description: 'AI analyzes your code and provides fixes.',
      category: ToolCategory.DEVELOPER,
      icon: Code2,
      inputs: [
          { id: 'code', label: 'Code Snippet', type: InputType.TEXTAREA },
          { id: 'context', label: 'Error/Context (Optional)', type: InputType.TEXT_INPUT }
      ],
      customHandler: (i) => complexTextTask(i, 'DEBUG')
    },
    {
      id: 'blog-writer',
      name: 'AI Blog Writer',
      tagline: 'FULL ARTICLES',
      description: 'Generate comprehensive blog posts optimized for engagement.',
      category: ToolCategory.WRITING,
      icon: PenTool,
      inputs: [
          { id: 'topic', label: 'Blog Topic', type: InputType.TEXT_INPUT, placeholder: 'Future of AI...' },
          { id: 'audience', label: 'Target Audience', type: InputType.TEXT_INPUT, placeholder: 'Tech enthusiasts' },
          { id: 'tone', label: 'Tone', type: InputType.SELECT, options: ['Informative', 'Casual', 'Professional', 'Humorous'] }
      ],
      customHandler: (i) => complexTextTask(i, 'BLOG')
    },
    {
      id: 'blog-ideas',
      name: 'Blog Topic Generator',
      tagline: 'CONTENT IDEAS',
      description: 'Generate 10-25 unique blog post ideas for your niche.',
      category: ToolCategory.WRITING,
      icon: Lightbulb,
      inputs: [
          { id: 'niche', label: 'Niche / Industry', type: InputType.TEXT_INPUT, placeholder: 'Fitness, Tech, Travel...' }
      ],
      customHandler: (i) => complexTextTask(i, 'BLOG_IDEAS')
    },
    {
      id: 'social-caption',
      name: 'Social Media Captions',
      tagline: 'INSTA & REELS',
      description: 'Generate captions in Short, Medium, and Long formats.',
      category: ToolCategory.WRITING,
      icon: UserCircle,
      inputs: [
          { id: 'topic', label: 'Post Topic / Image Description', type: InputType.TEXTAREA },
          { id: 'platform', label: 'Platform', type: InputType.SELECT, options: ['Instagram', 'YouTube', 'TikTok', 'Facebook'] },
          { id: 'mood', label: 'Mood', type: InputType.SELECT, options: ['Funny', 'Inspiring', 'Educational', 'Savage'] }
      ],
      customHandler: (i) => complexTextTask(i, 'SOCIAL_CAPTION')
    },
    {
      id: 'hashtag-gen',
      name: 'Hashtag Generator',
      tagline: 'VIRAL TAGS',
      description: 'Generate High, Medium, and Low competition hashtags.',
      category: ToolCategory.SEO,
      icon: Hash,
      inputs: [
          { id: 'topic', label: 'Post Topic / Keyword', type: InputType.TEXTAREA, placeholder: 'Sunset at the beach...' },
          { id: 'platform', label: 'Platform', type: InputType.SELECT, options: ['Instagram', 'TikTok', 'Twitter', 'LinkedIn'] }
      ],
      customHandler: (i) => complexTextTask(i, 'HASHTAGS')
    },
    {
      id: 'resume-email',
      name: 'Resume Writer',
      tagline: 'BUILD CV',
      description: 'Create professional resumes and cover letters.',
      category: ToolCategory.WRITING,
      icon: FileText,
      inputs: [
          { id: 'type', label: 'Document Type', type: InputType.SELECT, options: ['Resume', 'Email'] },
          { id: 'details', label: 'Details / Experience', type: InputType.TEXTAREA },
          { id: 'tone', label: 'Tone (For Email)', type: InputType.SELECT, options: ['Professional', 'Casual', 'Urgent'], defaultValue: 'Professional' }
      ],
      customHandler: (i) => complexTextTask(i, 'EMAIL_RESUME')
    },
    {
      id: 'resume-audit',
      name: 'Resume ATS Checker',
      tagline: 'GET HIRED',
      description: 'Format your resume for ATS systems and get improvements.',
      category: ToolCategory.PRODUCTIVITY,
      icon: FileText,
      inputs: [{ id: 'resume_text', label: 'Paste Resume Text', type: InputType.TEXTAREA }],
      customHandler: (i) => complexTextTask(i, 'RESUME_AUDIT')
    },
    {
      id: 'keyword-cluster',
      name: 'Keyword Cluster',
      tagline: 'SEO GROUPS',
      description: 'Group keywords by similarity and search intent.',
      category: ToolCategory.SEO,
      icon: Layers,
      inputs: [{ id: 'keywords', label: 'List of Keywords', type: InputType.TEXTAREA, placeholder: 'Paste list here...' }],
      customHandler: (i) => complexTextTask(i, 'KEYWORD_CLUSTER')
    },
    {
      id: 'seo-tool',
      name: 'SEO Meta Gen',
      tagline: 'TITLES & DESCS',
      description: 'Generate optimized titles (70 chars) and meta descriptions (160 chars).',
      category: ToolCategory.SEO,
      icon: Search,
      inputs: [{ id: 'text', label: 'Content / Topic', type: InputType.TEXTAREA }],
      customHandler: (i) => complexTextTask(i, 'SEO')
    },
    {
      id: 'yt-summary',
      name: 'YouTube Summary',
      tagline: 'TL;DR VIDEO',
      description: 'Paste a video transcript to get a concise summary.',
      category: ToolCategory.PRODUCTIVITY,
      icon: Video,
      inputs: [{ id: 'text', label: 'Paste Transcript', type: InputType.TEXTAREA }],
      customHandler: (i) => complexTextTask(i, 'SUMMARIZE')
    },
    {
      id: 'translator',
      name: 'AI Translator',
      tagline: '50+ LANGUAGES',
      description: 'Translate text accurately into any major language.',
      category: ToolCategory.UTILITY,
      icon: Languages,
      inputs: [
          { id: 'text', label: 'Text to Translate', type: InputType.TEXTAREA },
          { id: 'language', label: 'Target Language', type: InputType.SELECT, options: ['Spanish', 'French', 'German', 'Chinese', 'Japanese', 'Hindi', 'Arabic', 'Russian', 'Portuguese', 'Italian'] }
      ],
      customHandler: (i) => complexTextTask(i, 'TRANSLATE')
    },
    {
      id: 'stt',
      name: 'Voice to Text',
      tagline: 'WHISPER AI',
      description: 'Convert audio files into text using Whisper V3.',
      category: ToolCategory.MEDIA,
      icon: Mic,
      inputs: [{ id: 'audio', label: 'Upload Audio', type: InputType.FILE, accept: 'audio/*' }],
      customHandler: speechToText
    },
    {
      id: 'remove-bg',
      name: 'Background Remover',
      tagline: 'TRANSPARENT PNG',
      description: 'Remove backgrounds instantly using ApyHub.',
      category: ToolCategory.MEDIA,
      icon: Eraser,
      inputs: [{ id: 'image', label: 'Upload Image', type: InputType.FILE, accept: 'image/*' }],
      customHandler: removeBackground
    },
    {
      id: 'anime-converter',
      name: 'Face to Anime',
      tagline: 'ANIME STYLE',
      description: 'Convert a photo into anime style using AI.',
      category: ToolCategory.MEDIA,
      icon: Sparkles,
      inputs: [{ id: 'image', label: 'Upload Photo', type: InputType.FILE, accept: 'image/*' }],
      customHandler: (i) => imageToAnime(i)
    },
    {
      id: 'image-upscaler',
      name: 'Image Upscaler',
      tagline: 'ENHANCE QUALITY',
      description: 'Upscale low-res images by 2x/4x using AI.',
      category: ToolCategory.MEDIA,
      icon: Monitor,
      inputs: [{ id: 'image', label: 'Upload Image', type: InputType.FILE, accept: 'image/*' }],
      customHandler: (i) => imageUpscale(i)
    },
    {
      id: 'image-caption',
      name: 'Image Caption Gen',
      tagline: 'BLIP MODEL',
      description: 'Generate descriptive captions for your images.',
      category: ToolCategory.MEDIA,
      icon: Camera,
      inputs: [{ id: 'image', label: 'Upload Image', type: InputType.FILE, accept: 'image/*' }],
      customHandler: imageCaption
    },
    {
      id: 'ocr',
      name: 'OCR Scanner',
      tagline: 'EXTRACT TEXT',
      description: 'Convert images of documents into editable text.',
      category: ToolCategory.UTILITY,
      icon: FileText,
      inputs: [{ id: 'image', label: 'Upload Image', type: InputType.FILE, accept: 'image/*' }],
      customHandler: ocrImage
    },
    {
      id: 'tts',
      name: 'Text to Speech',
      tagline: 'HUMAN VOICE',
      description: 'Convert text to natural sounding speech.',
      category: ToolCategory.MEDIA,
      icon: Speaker,
      inputs: [{ id: 'text', label: 'Text to Speak', type: InputType.TEXTAREA }],
      customHandler: textToSpeech
    },
    {
      id: 'flashcards',
      name: 'Flashcard Generator',
      tagline: 'STUDY AID',
      description: 'Turn your notes into exam-ready flashcards.',
      category: ToolCategory.PRODUCTIVITY,
      icon: StickyNote,
      inputs: [{ id: 'text', label: 'Paste Notes', type: InputType.TEXTAREA }],
      customHandler: (i) => complexTextTask(i, 'FLASHCARDS')
    },
    {
      id: 'pdf-cleaner',
      name: 'Text Cleaner',
      tagline: 'FORMAT FIXER',
      description: 'Paste copied PDF text to clean formatting and summarize.',
      category: ToolCategory.UTILITY,
      icon: FileText,
      inputs: [{ id: 'text', label: 'Paste Messy Text', type: InputType.TEXTAREA }],
      customHandler: (i) => complexTextTask(i, 'PDF_CLEAN')
    },
    {
      id: 'prompt-gen',
      name: 'Prompt Engineer',
      tagline: 'OPTIMIZE PROMPTS',
      description: 'Turn basic ideas into powerful coding prompts.',
      category: ToolCategory.DEVELOPER,
      icon: BrainCircuit,
      inputs: [{ id: 'idea', label: 'Basic Idea', type: InputType.TEXTAREA, placeholder: 'A react app for todo list...' }],
      customHandler: (i) => complexTextTask(i, 'PROMPT_GEN')
    },
    {
      id: 'meme-gen',
      name: 'Meme Generator',
      tagline: 'MAKE IT FUNNY',
      description: 'Upload an image and let AI write the meme text.',
      category: ToolCategory.MEDIA,
      icon: Smile,
      inputs: [
          { id: 'image', label: 'Image (Optional for Context)', type: InputType.FILE, accept: 'image/*' },
          { id: 'topic', label: 'Topic / Theme', type: InputType.TEXT_INPUT, placeholder: 'Programming bugs...' }
      ],
      customHandler: memeGeneratorHandler
    },
    {
      id: 'color-palette',
      name: 'Color Palette',
      tagline: 'EXTRACT COLORS',
      description: 'Extract the top 5 dominant colors from an image.',
      category: ToolCategory.DESIGN,
      icon: Palette,
      inputs: [{ id: 'image', label: 'Upload Image', type: InputType.FILE, accept: 'image/*' }],
      customHandler: extractColorPalette
    },
    {
      id: 'emotion-detect',
      name: 'Emotion Detector',
      tagline: 'SENTIMENT AI',
      description: 'Analyze the tone and emotion behind any text.',
      category: ToolCategory.PRODUCTIVITY,
      icon: Heart,
      inputs: [{ id: 'text', label: 'Text to Analyze', type: InputType.TEXTAREA }],
      customHandler: (i) => complexTextTask(i, 'EMOTION')
    },
    {
      id: 'story-writer',
      name: 'AI Story Writer',
      tagline: 'CREATIVE WRITING',
      description: 'Generate creative stories, scripts, or anime plots.',
      category: ToolCategory.WRITING,
      icon: BookOpen,
      inputs: [
          { id: 'topic', label: 'Story Idea', type: InputType.TEXTAREA },
          { id: 'genre', label: 'Genre', type: InputType.SELECT, options: ['Sci-Fi', 'Fantasy', 'Anime', 'Horror', 'Romance'] },
          { id: 'length', label: 'Length', type: InputType.SELECT, options: ['Short (300 words)', 'Medium (800 words)', 'Long (1500 words)'] }
      ],
      customHandler: (i) => complexTextTask(i, 'STORY')
    },
    {
      id: 'quiz-gen',
      name: 'Quiz Generator',
      tagline: 'MAKE TESTS',
      description: 'Create multiple-choice questions from any text.',
      category: ToolCategory.PRODUCTIVITY,
      icon: FileJson,
      inputs: [{ id: 'text', label: 'Source Material', type: InputType.TEXTAREA }],
      customHandler: (i) => complexTextTask(i, 'QUIZ')
    },
    {
      id: 'url-shortener',
      name: 'URL Shortener',
      tagline: 'LINK MANAGER',
      description: 'Shorten long URLs using ShrinkEarn or Cuty.io.',
      category: ToolCategory.UTILITY,
      icon: LinkIcon,
      inputs: [
          { id: 'url', label: 'Long URL', type: InputType.TEXT_INPUT, placeholder: 'https://example.com' },
          { id: 'provider', label: 'Service Provider', type: InputType.SELECT, options: ['ShrinkEarn', 'Cuty.io'], defaultValue: 'ShrinkEarn' },
          { id: 'alias', label: 'Custom Alias (Cuty.io only)', type: InputType.TEXT_INPUT, placeholder: 'my-custom-link' }
      ],
      customHandler: shortenUrl
    },
    {
      id: 'yt-tags',
      name: 'YouTube Tag Gen',
      tagline: 'VIDEO SEO',
      description: 'Generate optimized tags for YouTube videos.',
      category: ToolCategory.SEO,
      icon: Tag,
      inputs: [
          { id: 'title', label: 'Video Title', type: InputType.TEXT_INPUT },
          { id: 'description', label: 'Video Description', type: InputType.TEXTAREA }
      ],
      customHandler: (i) => complexTextTask(i, 'YT_TAGS')
    },
    {
      id: 'bio-gen',
      name: 'Social Bio Generator',
      tagline: 'PERFECT PROFILE',
      description: 'Create engaging bios for Instagram, Twitter, or LinkedIn.',
      category: ToolCategory.WRITING,
      icon: UserCircle,
      inputs: [
          { id: 'about', label: 'About You / Brand', type: InputType.TEXTAREA },
          { id: 'platform', label: 'Platform', type: InputType.SELECT, options: ['Instagram', 'Twitter', 'LinkedIn', 'Tinder'] },
          { id: 'vibe', label: 'Vibe', type: InputType.SELECT, options: ['Professional', 'Funny', 'Aesthetic', 'Minimalist'] }
      ],
      customHandler: (i) => complexTextTask(i, 'BIO')
    },
    {
      id: 'slogan-gen',
      name: 'Slogan Generator',
      tagline: 'CATCHY PHRASES',
      description: 'Generate catchy slogans and taglines for your business.',
      category: ToolCategory.WRITING,
      icon: Lightbulb,
      inputs: [
          { id: 'brand', label: 'Brand Name', type: InputType.TEXT_INPUT },
          { id: 'description', label: 'What do you do?', type: InputType.TEXTAREA }
      ],
      customHandler: (i) => complexTextTask(i, 'SLOGAN')
    },
    {
      id: 'domain-gen',
      name: 'Domain Name Gen',
      tagline: 'BRANDABLE URLS',
      description: 'Generate creative available domain name ideas.',
      category: ToolCategory.UTILITY,
      icon: Globe,
      inputs: [
          { id: 'keywords', label: 'Keywords', type: InputType.TEXT_INPUT, placeholder: 'tech, ai, fast' },
          { id: 'extension', label: 'Extension Preference', type: InputType.SELECT, options: ['.com', '.io', '.ai', '.app', 'Any'] }
      ],
      customHandler: (i) => complexTextTask(i, 'DOMAIN')
    },
    {
      id: 'job-desc',
      name: 'Job Description',
      tagline: 'HR TOOLS',
      description: 'Write professional job descriptions instantly.',
      category: ToolCategory.PRODUCTIVITY,
      icon: Briefcase,
      inputs: [
          { id: 'role', label: 'Job Title', type: InputType.TEXT_INPUT },
          { id: 'skills', label: 'Required Skills', type: InputType.TEXTAREA }
      ],
      customHandler: (i) => complexTextTask(i, 'JOB_DESC')
    },
    {
      id: 'interview-questions',
      name: 'Interview Prep',
      tagline: 'HIRE SMARTER',
      description: 'Generate interview questions for any job role.',
      category: ToolCategory.PRODUCTIVITY,
      icon: Target,
      inputs: [
          { id: 'role', label: 'Job Role', type: InputType.TEXT_INPUT },
          { id: 'level', label: 'Difficulty Level', type: InputType.SELECT, options: ['Intern', 'Junior', 'Senior', 'Executive'] }
      ],
      customHandler: (i) => complexTextTask(i, 'INTERVIEW')
    },
    {
      id: 'cover-letter',
      name: 'Cover Letter Gen',
      tagline: 'GET HIRED',
      description: 'Write a tailored cover letter for your job application.',
      category: ToolCategory.WRITING,
      icon: FileText,
      inputs: [
          { id: 'role', label: 'Job Role Applied For', type: InputType.TEXT_INPUT },
          { id: 'company', label: 'Company Name', type: InputType.TEXT_INPUT },
          { id: 'experience', label: 'Your Key Experience', type: InputType.TEXTAREA }
      ],
      customHandler: (i) => complexTextTask(i, 'COVER_LETTER')
    },
    {
      id: 'product-desc',
      name: 'Product Description',
      tagline: 'E-COMMERCE',
      description: 'Generate persuasive product descriptions for sales.',
      category: ToolCategory.WRITING,
      icon: ShoppingBag,
      inputs: [
          { id: 'product', label: 'Product Name', type: InputType.TEXT_INPUT },
          { id: 'features', label: 'Key Features', type: InputType.TEXTAREA }
      ],
      customHandler: (i) => complexTextTask(i, 'PRODUCT_DESC')
    },
    {
      id: 'text-improver',
      name: 'Text Improver',
      tagline: 'POLISH TEXT',
      description: 'Rewrite text to be more professional, concise, or engaging.',
      category: ToolCategory.WRITING,
      icon: RefreshCw,
      inputs: [
          { id: 'text', label: 'Original Text', type: InputType.TEXTAREA },
          { id: 'goal', label: 'Goal', type: InputType.SELECT, options: ['Fix Grammar', 'Make Professional', 'Make Concise', 'Expand', 'Simplifiy'] }
      ],
      customHandler: (i) => complexTextTask(i, 'REWRITE')
    },
    {
      id: 'startup-idea',
      name: 'Startup Generator',
      tagline: 'NEXT BIG THING',
      description: 'Generate unique startup ideas based on industry trends.',
      category: ToolCategory.DEVELOPER,
      icon: Rocket,
      inputs: [
          { id: 'industry', label: 'Industry', type: InputType.TEXT_INPUT, placeholder: 'Fintech, Health, AI...' }
      ],
      customHandler: (i) => complexTextTask(i, 'STARTUP')
    }
  ];

  // --- CONTEXTS ---
  // Toast Context
  const ToastContext = createContext(undefined);
  const useToast = () => {
    const context = useContext(ToastContext);
    if (!context) throw new Error('useToast must be used within a ToastProvider');
    return context;
  };
  const ToastProvider = ({ children }) => {
    const [toasts, setToasts] = useState([]);
    const showToast = useCallback((message, type = 'info') => {
      const id = Math.random().toString(36).substring(7);
      setToasts((prev) => [...prev, { id, message, type }]);
      setTimeout(() => setToasts((prev) => prev.filter((t) => t.id !== id)), 4000);
    }, []);
    const removeToast = (id) => setToasts((prev) => prev.filter((t) => t.id !== id));
    return (
      <ToastContext.Provider value={{ showToast }}>
        {children}
        <div className="fixed bottom-6 right-6 z-[100] flex flex-col gap-3 pointer-events-none">
          <AnimatePresence>
            {toasts.map((toast) => (
              <motion.div
                key={toast.id}
                initial={{ opacity: 0, x: 50, scale: 0.9 }}
                animate={{ opacity: 1, x: 0, scale: 1 }}
                exit={{ opacity: 0, x: 20, scale: 0.9 }}
                layout
                className="pointer-events-auto flex items-center gap-3 px-4 py-3 rounded-xl backdrop-blur-md border shadow-2xl min-w-[300px]"
                style={{
                  backgroundColor: toast.type === 'error' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(21, 21, 24, 0.8)',
                  borderColor: toast.type === 'error' ? 'rgba(239, 68, 68, 0.3)' : 'rgba(255, 255, 255, 0.1)',
                }}
              >
                <div className={`p-1 rounded-full ${
                  toast.type === 'success' ? 'bg-green-500/20 text-green-400' :
                  toast.type === 'error' ? 'bg-red-500/20 text-red-400' :
                  'bg-blue-500/20 text-blue-400'
                }`}>
                  {toast.type === 'success' && <Check size={16} />}
                  {toast.type === 'error' && <AlertCircle size={16} />}
                  {toast.type === 'info' && <HelpCircle size={16} />}
                </div>
                <p className="text-sm font-medium text-white flex-1">{toast.message}</p>
                <button onClick={() => removeToast(toast.id)} className="text-white/40 hover:text-white transition-colors">
                  <X size={14} />
                </button>
              </motion.div>
            ))}
          </AnimatePresence>
        </div>
      </ToastContext.Provider>
    );
  };

  // User Context
  const UserContext = createContext(undefined);
  const useUser = () => {
    const context = useContext(UserContext);
    if (!context) throw new Error('useUser must be used within a UserProvider');
    return context;
  };
  const UserProvider = ({ children }) => {
    const [xp, setXp] = useState(() => {
      try {
        const saved = localStorage.getItem('infarno_xp');
        const parsed = saved ? parseInt(saved, 10) : 0;
        return isNaN(parsed) ? 0 : parsed;
      } catch { return 0; }
    });
    const [favorites, setFavorites] = useState(() => {
      try {
        const saved = localStorage.getItem('infarno_favs');
        return saved ? JSON.parse(saved) : [];
      } catch { return []; }
    });
    const [recentTools, setRecentTools] = useState(() => {
      try {
        const saved = localStorage.getItem('infarno_recents');
        return saved ? JSON.parse(saved) : [];
      } catch { return []; }
    });
    const [history, setHistory] = useState(() => {
      try {
        const saved = localStorage.getItem('infarno_history');
        return saved ? JSON.parse(saved) : {};
      } catch { return {}; }
    });
    useEffect(() => { try { localStorage.setItem('infarno_xp', xp.toString()); } catch {} }, [xp]);
    useEffect(() => { try { localStorage.setItem('infarno_favs', JSON.stringify(favorites)); } catch {} }, [favorites]);
    useEffect(() => { try { localStorage.setItem('infarno_recents', JSON.stringify(recentTools)); } catch {} }, [recentTools]);
    useEffect(() => { try { localStorage.setItem('infarno_history', JSON.stringify(history)); } catch {} }, [history]);

    const addXp = (amount) => setXp(prev => prev + amount);
    const toggleFavorite = (toolId) => setFavorites(prev => prev.includes(toolId) ? prev.filter(id => id !== toolId) : [...prev, toolId]);
    const addRecent = (toolId) => setRecentTools(prev => { const filtered = prev.filter(id => id !== toolId); return [toolId, ...filtered].slice(0, 5); });
    const addToHistory = (toolId, item) => setHistory(prev => ({ ...prev, [toolId]: [item, ...(prev[toolId] || [])].slice(0, 10) }));
    const clearHistory = (toolId) => setHistory(prev => { const next = { ...prev }; delete next[toolId]; return next; });

    return (
      <UserContext.Provider value={{ xp, addXp, favorites, toggleFavorite, recentTools, addRecent, history, addToHistory, clearHistory }}>
        {children}
      </UserContext.Provider>
    );
  };

  // --- COMPONENTS ---
  class ErrorBoundary extends React.Component {
    constructor(props) {
      super(props);
      this.state = { hasError: false, error: null };
    }
    static getDerivedStateFromError(error) {
      return { hasError: true, error };
    }
    componentDidCatch(error, errorInfo) {
      console.error("Uncaught error:", error, errorInfo);
    }
    render() {
      if (this.state.hasError) {
        return (
          <div className="min-h-screen flex flex-col items-center justify-center bg-[#0B0B0D] text-white p-4 text-center">
            <div className="bg-red-500/10 p-6 rounded-full mb-6 border border-red-500/20">
              <AlertTriangle size={48} className="text-red-500" />
            </div>
            <h1 className="text-2xl font-bold mb-2">Something went wrong</h1>
            <p className="text-gray-400 max-w-md mb-8">The application encountered a critical error. This usually happens due to a momentary glitch or a network timeout.</p>
            <div className="bg-white/5 p-4 rounded-lg mb-8 max-w-lg w-full overflow-auto text-left border border-white/10">
              <p className="font-mono text-xs text-red-300">{this.state.error?.message || "Unknown Error"}</p>
            </div>
            <button onClick={() => window.location.reload()} className="flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary/80 rounded-xl font-bold transition-all">
              <RefreshCw size={18} /> Reload Application
            </button>
          </div>
        );
      }
      return this.props.children;
    }
  }

  const FloatingBackground = () => (
    <div className="fixed inset-0 z-0 overflow-hidden pointer-events-none">
      <div className="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-primary/20 rounded-full blur-[120px] animate-blob mix-blend-screen opacity-30" />
      <div className="absolute bottom-[-10%] right-[-10%] w-[600px] h-[600px] bg-secondary/10 rounded-full blur-[120px] animate-blob animation-delay-2000 mix-blend-screen opacity-20" />
      <div className="absolute top-[40%] left-[60%] w-[200px] h-[200px] bg-purple-500/10 rounded-full blur-[80px] animate-blob animation-delay-4000" />
      <div className="absolute top-[20%] right-[30%] w-[150px] h-[150px] bg-blue-500/10 rounded-full blur-[60px] animate-blob animation-delay-1000" />
      <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03]"></div>
    </div>
  );

  const DonationModal = ({ isOpen, onClose }) => {
    const [copiedId, setCopiedId] = useState(null);
    const [amount, setAmount] = useState('10');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState(null);
    const handleCopy = (text, id) => { navigator.clipboard.writeText(text); setCopiedId(id); setTimeout(() => setCopiedId(null), 2000); };
    const handleMaxelPayment = async () => {
      const val = parseFloat(amount);
      if (!val || val <= 0) return;
      setLoading(true); setError(null);
      try {
          const url = await createMaxelPayOrder(val);
          if (url) window.open(url, '_blank');
          else throw new Error("Invalid URL received.");
      } catch (e) { setError(`Failed: ${e.message}`); } finally { setLoading(false); }
    };
    const DONATION_OPTIONS = [
      { id: 'maxelpay', name: 'MaxelPay', network: 'Global Crypto Gateway', address: '', qrData: '', color: 'from-blue-600 to-indigo-600', icon: Globe, iconColor: 'text-blue-400', isGateway: true },
      { id: 'binance', name: 'Binance Pay', network: 'Binance App', address: 'Cshloop', qrData: 'Cshloop', color: 'from-yellow-400 to-amber-500', icon: Zap, iconColor: 'text-yellow-600' },
      { id: 'trc20', name: 'USDT', network: 'Tron (TRC20)', address: 'TDLCrywcgMaEJtN9WTzHWqyfG1WfZwvtzQ', qrData: 'TDLCrywcgMaEJtN9WTzHWqyfG1WfZwvtzQ', color: 'from-green-500 to-emerald-500', icon: Wallet, iconColor: 'text-emerald-500' }
    ];
    return (
      <AnimatePresence>
        {isOpen && (
          <>
            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={onClose} className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[150]" />
            <div className="fixed inset-0 z-[151] flex items-center justify-center p-4 pointer-events-none">
              <motion.div initial={{ scale: 0.9, opacity: 0, y: 20 }} animate={{ scale: 1, opacity: 1, y: 0 }} exit={{ scale: 0.9, opacity: 0, y: 20 }} transition={{ type: "spring", damping: 25, stiffness: 300 }} className="bg-[#151518] border border-white/10 w-full max-w-4xl rounded-3xl shadow-2xl overflow-hidden pointer-events-auto flex flex-col max-h-[90vh]">
                <div className="relative p-8 text-center border-b border-white/5 bg-gradient-to-b from-primary/10 to-transparent">
                  <button onClick={onClose} className="absolute top-4 right-4 p-2 rounded-full bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-colors"><X size={20} /></button>
                  <div className="inline-flex items-center justify-center p-3 rounded-2xl bg-gradient-to-tr from-primary to-secondary mb-4 shadow-lg shadow-primary/20"><Heart className="text-white fill-white" size={32} /></div>
                  <h2 className="text-3xl font-bold text-white mb-2">Support Infarno Tools</h2>
                  <p className="text-gray-400 max-w-md mx-auto">Your contribution helps us keep these premium AI tools free, open-source, and constantly evolving.</p>
                </div>
                <div className="p-6 md:p-8 overflow-y-auto custom-scrollbar bg-[#0B0B0D]">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {DONATION_OPTIONS.map((option) => (
                      <div key={option.id} className="group relative bg-white/5 rounded-2xl p-5 border border-white/5 hover:border-white/10 transition-all hover:-translate-y-1 flex flex-col h-full">
                        <div className={`absolute inset-x-0 top-0 h-1 bg-gradient-to-r ${option.color} opacity-50 rounded-t-2xl`}></div>
                        <div className="flex items-center gap-2 mb-4">
                          <div className={`p-2 rounded-lg bg-gradient-to-br ${option.color} bg-opacity-10`}><option.icon size={16} className="text-white" /></div>
                          <div><h3 className="font-bold text-white text-sm">{option.name}</h3><span className="text-[10px] uppercase font-mono text-gray-500">{option.network}</span></div>
                        </div>
                        {option.isGateway ? (
                            <div className="flex-1 flex flex-col justify-between">
                               <div className="space-y-4 mb-4">
                                  <p className="text-xs text-gray-400 leading-relaxed">Donate securely using popular cryptocurrencies via MaxelPay. Instant processing.</p>
                                  <div>
                                      <label className="text-[10px] text-gray-500 font-bold uppercase mb-1 block">Amount (USD)</label>
                                      <div className="relative"><span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</span><input type="number" value={amount} onChange={(e) => setAmount(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl py-2.5 pl-7 pr-3 text-white text-sm focus:outline-none focus:border-blue-500/50 transition-colors" /></div>
                                  </div>
                               </div>
                               {error && <p className="text-[10px] text-red-400 mb-2 border-l-2 border-red-500 pl-2">{error}</p>}
                               <button onClick={handleMaxelPayment} disabled={loading} className="w-full py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white shadow-lg shadow-blue-500/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed">{loading ? 'Processing...' : <>Proceed <ArrowRight size={14} /></>}</button>
                            </div>
                        ) : (
                            <div className="flex-1 flex flex-col">
                              <div className="relative bg-white p-3 rounded-xl mb-5 mx-auto max-w-[180px] aspect-square flex items-center justify-center shadow-inner w-full"><img src={`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(option.qrData)}`} alt={`${option.name} QR`} className="w-full h-full object-contain mix-blend-multiply opacity-90" /><div className="absolute inset-0 flex items-center justify-center"><div className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg ring-4 ring-white"><option.icon size={20} className={option.iconColor} /></div></div></div>
                              <div className="space-y-3 mt-auto"><div className="bg-black/40 rounded-lg p-3 border border-white/5 break-all"><p className="text-[10px] font-mono text-gray-400 text-center leading-relaxed select-all">{option.address}</p></div><button onClick={() => handleCopy(option.address, option.id)} className={`w-full py-2.5 rounded-xl font-medium text-sm flex items-center justify-center gap-2 transition-all ${copiedId === option.id ? 'bg-green-500/20 text-green-400 border border-green-500/30' : 'bg-white/5 hover:bg-white/10 text-white border border-white/5'}`}>{copiedId === option.id ? <><Check size={14} /> Copied</> : <><Copy size={14} /> Copy Address</>}</button></div>
                            </div>
                        )}
                      </div>
                    ))}
                  </div>
                  <div className="mt-8 text-center"><p className="text-xs text-gray-500">Thank you for being part of our journey. Every transaction is secure and directly supports development.</p></div>
                </div>
              </motion.div>
            </div>
          </>
        )}
      </AnimatePresence>
    );
  };

  const Navbar = () => {
    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
    const { xp } = useUser();
    const location = useLocation();
    const isActive = (path) => location.pathname === path ? "text-white" : "text-text-muted hover:text-white";
    return (
      <nav className="sticky top-0 z-50 w-full border-b border-white/5 bg-[#0B0B0D]/80 backdrop-blur-md">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16">
            <Link to="/" className="flex items-center gap-2 group">
              <motion.div whileHover={{ rotate: 180, scale: 1.1 }} transition={{ duration: 0.5 }} className="relative flex items-center justify-center w-8 h-8 rounded-lg bg-gradient-to-tr from-primary to-secondary">
                <Flame className="w-5 h-5 text-white fill-white" />
                <div className="absolute inset-0 bg-white/20 blur-md rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"></div>
              </motion.div>
              <span className="text-lg font-bold tracking-tight text-white group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-white group-hover:to-gray-400 transition-all">Infarno Tools</span>
            </Link>
            <div className="hidden md:flex items-center space-x-6">
               <motion.div whileHover={{ scale: 1.05 }} className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition-colors cursor-help" title="Generate content to earn XP">
                  <Zap size={14} className="text-yellow-400 fill-yellow-400" />
                  <span className="text-xs font-mono font-medium text-white">{xp} XP</span>
               </motion.div>
              <div className="h-4 w-px bg-white/10"></div>
              {['/about', '/support', '/contact'].map((path) => (
                  <Link key={path} to={path} className={`text-sm font-medium transition-colors px-3 py-1 rounded-md relative ${isActive(path)}`}>
                      {path.replace('/', '').charAt(0).toUpperCase() + path.replace('/', '').slice(1)}
                      {location.pathname === path && <motion.div layoutId="navHighlight" className="absolute inset-0 bg-white/5 rounded-md -z-10" transition={{ type: "spring", stiffness: 300, damping: 30 }} />}
                  </Link>
              ))}
            </div>
            <div className="md:hidden flex items-center gap-4">
              <div className="flex items-center gap-1.5 px-2 py-1 rounded-full bg-white/5 border border-white/10">
                  <Zap size={12} className="text-yellow-400 fill-yellow-400" />
                  <span className="text-xs font-mono font-medium text-white">{xp}</span>
               </div>
              <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="p-2 text-text-muted hover:text-white transition-colors">
                {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
              </button>
            </div>
          </div>
        </div>
        {isMobileMenuOpen && (
          <motion.div initial={{ opacity: 0, height: 0 }} animate={{ opacity: 1, height: 'auto' }} exit={{ opacity: 0, height: 0 }} className="md:hidden bg-[#0B0B0D] border-b border-white/10 overflow-hidden">
            <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3">
               <Link to="/about" className="block px-3 py-2 rounded-md text-base font-medium text-text-muted hover:text-white hover:bg-white/5" onClick={() => setIsMobileMenuOpen(false)}>About</Link>
               <Link to="/support" className="block px-3 py-2 rounded-md text-base font-medium text-text-muted hover:text-white hover:bg-white/5" onClick={() => setIsMobileMenuOpen(false)}>Docs</Link>
               <Link to="/contact" className="block px-3 py-2 rounded-md text-base font-medium text-text-muted hover:text-white hover:bg-white/5" onClick={() => setIsMobileMenuOpen(false)}>Contact</Link>
            </div>
          </motion.div>
        )}
      </nav>
    );
  };

  const ToolCard = ({ tool }) => {
    const itemVariants = { hidden: { opacity: 0, y: 30, scale: 0.95 }, visible: { opacity: 1, y: 0, scale: 1, transition: { type: "spring", stiffness: 200, damping: 20 } } };
    return (
      <motion.div variants={itemVariants} whileHover={{ y: -8, scale: 1.02 }} whileTap={{ scale: 0.98 }} className="h-full">
        <Link to={`/tool/${tool.id}`} className="group relative block h-full">
          <div className="absolute -inset-0.5 bg-gradient-to-r from-primary/30 to-secondary/30 rounded-[26px] opacity-0 group-hover:opacity-100 blur-md transition duration-500 group-hover:duration-200"></div>
          <div className="relative h-full glass-panel rounded-3xl p-6 flex flex-col bg-[#151518]/90 group-hover:bg-[#151518]/95 transition-colors border border-white/5 group-hover:border-white/10 overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-tr from-white/0 via-white/5 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000 ease-in-out pointer-events-none"></div>
            <div className="flex justify-between items-start mb-5 relative z-10">
              <motion.div className="p-3.5 rounded-2xl bg-white/5 border border-white/10 text-white" whileHover={{ rotate: 5, scale: 1.1 }} transition={{ type: "spring", stiffness: 300 }}>
                <tool.icon className="w-6 h-6" />
              </motion.div>
              <div className="p-2 rounded-full bg-white/5 opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all duration-300"><ArrowUpRight className="w-4 h-4 text-white" /></div>
            </div>
            <h3 className="text-xl font-bold text-white mb-2 group-hover:text-primary transition-colors relative z-10">{tool.name}</h3>
            <span className="text-[10px] font-bold tracking-widest uppercase text-secondary/80 mb-3 block relative z-10">{tool.tagline}</span>
            <p className="text-sm text-text-muted leading-relaxed line-clamp-2 group-hover:text-gray-300 transition-colors relative z-10">{tool.description}</p>
          </div>
        </Link>
      </motion.div>
    );
  };

  const OutputSection = ({ content, isGenerating, history, onRestore, onClear }) => {
    const [activeTab, setActiveTab] = useState('current');
    const [copied, setCopied] = useState(false);
    const { showToast } = useToast();
    const handleCopy = (text) => { navigator.clipboard.writeText(text); setCopied(true); showToast("Copied to clipboard", "success"); setTimeout(() => setCopied(false), 2000); };
    const handleDownload = () => {
      const isImage = content.startsWith('data:image') || content.startsWith('http');
      const element = document.createElement("a");
      if (isImage) { element.href = content; element.download = "infarno_image.png"; } 
      else { const file = new Blob([content], {type: 'text/plain'}); element.href = URL.createObjectURL(file); element.download = "infarno_result.txt"; }
      document.body.appendChild(element); element.click(); document.body.removeChild(element); showToast("Download started", "success");
    };
    const renderContent = (data) => {
      const trimmed = data.trim();
      if (trimmed.startsWith('data:image') || (trimmed.startsWith('http') && (trimmed.endsWith('.png') || trimmed.includes('qrserver')))) {
          return (<motion.div initial={{ scale: 0.8, opacity: 0, rotateX: 10 }} animate={{ scale: 1, opacity: 1, rotateX: 0 }} transition={{ type: "spring", stiffness: 100, damping: 15 }} className="flex flex-col items-center justify-center p-4 perspective-1000"><img src={trimmed} alt="Generated" className="max-w-full h-auto rounded-lg shadow-2xl border border-white/10 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] hover:scale-[1.01] transition-transform duration-500" /></motion.div>);
      }
      if (trimmed.startsWith('data:audio')) {
          return (<motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="flex flex-col items-center justify-center p-8"><div className="p-6 rounded-full bg-primary/20 mb-4 animate-pulse relative"><Music size={48} className="text-primary relative z-10" /><div className="absolute inset-0 bg-primary/30 rounded-full animate-ping"></div></div><audio controls src={trimmed} className="w-full max-w-md" /></motion.div>);
      }
      if (trimmed.startsWith('<svg')) { return (<div className="flex flex-col items-center justify-center p-4"><div className="w-64 h-64 bg-transparent" dangerouslySetInnerHTML={{ __html: trimmed }} /></div>); }
      return (<motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5 }} className="whitespace-pre-wrap font-mono text-sm leading-relaxed text-gray-300">{trimmed.split('\n').map((line, i) => (<motion.div key={i} initial={{ opacity: 0, x: -5 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: i * 0.05 }}>{line}{'\n'}</motion.div>))}</motion.div>);
    };
    return (
      <div className="relative group">
        <motion.div layout className="relative w-full min-h-[400px] glass-panel rounded-2xl border border-white/10 overflow-hidden flex flex-col shadow-xl bg-[#0B0B0D]/80">
          <div className="flex items-center justify-between px-6 py-4 border-b border-white/5 bg-white/5 backdrop-blur-sm">
              <div className="flex bg-[#0B0B0D] rounded-lg p-1 border border-white/5">
                  <button onClick={() => setActiveTab('current')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all relative ${activeTab === 'current' ? 'text-white' : 'text-text-muted hover:text-white'}`}>{activeTab === 'current' && <motion.div layoutId="activeTab" className="absolute inset-0 bg-white/10 rounded-md shadow-sm" transition={{ type: "spring", stiffness: 500, damping: 30 }} />}<span className="relative z-10 flex items-center gap-2"><Terminal size={14} /> Output</span></button>
                  <button onClick={() => setActiveTab('history')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all relative ${activeTab === 'history' ? 'text-white' : 'text-text-muted hover:text-white'}`}>{activeTab === 'history' && <motion.div layoutId="activeTab" className="absolute inset-0 bg-white/10 rounded-md shadow-sm" transition={{ type: "spring", stiffness: 500, damping: 30 }} />}<span className="relative z-10 flex items-center gap-2"><History size={14} /> History {history.length > 0 && <span className="text-[10px] bg-primary/20 text-primary px-1.5 rounded-full">{history.length}</span>}</span></button>
              </div>
              {activeTab === 'current' && (<div className="flex items-center gap-2"><motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={() => handleCopy(content)} disabled={!content || isGenerating} className="p-2 rounded-lg bg-white/5 hover:bg-white/10 text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-xs font-medium" title="Copy to clipboard">{copied ? <Check size={14} className="text-green-400" /> : <Copy size={14} />}</motion.button><motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={handleDownload} disabled={!content || isGenerating} className="p-2 rounded-lg bg-white/5 hover:bg-white/10 text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-xs font-medium" title="Download"><Download size={14} /></motion.button></div>)}
              {activeTab === 'history' && history.length > 0 && (<button onClick={onClear} className="p-2 rounded-lg bg-white/5 hover:bg-red-500/20 text-text-muted hover:text-red-400 transition-all flex items-center gap-2 text-xs font-medium" title="Clear History"><Trash2 size={14} /></button>)}
          </div>
          <div className="flex-1 p-0 overflow-hidden relative bg-[#0B0B0D]/40">
              {activeTab === 'current' ? (
                  <div className="h-full p-6 overflow-y-auto max-h-[600px] scroll-smooth custom-scrollbar">
                      <AnimatePresence mode='wait'>
                      {isGenerating ? (
                          <motion.div key="loading" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="flex flex-col items-center justify-center h-full space-y-8"><div className="relative w-24 h-24"><motion.span className="absolute inset-0 rounded-full border-4 border-t-primary border-r-transparent border-b-secondary border-l-transparent" animate={{ rotate: 360 }} transition={{ duration: 1.5, repeat: Infinity, ease: "linear" }} /><motion.span className="absolute inset-2 rounded-full border-4 border-t-transparent border-r-secondary border-b-primary border-l-transparent" animate={{ rotate: -360 }} transition={{ duration: 2, repeat: Infinity, ease: "linear" }} /><div className="absolute inset-0 flex items-center justify-center"><Sparkles className="text-white opacity-80 animate-pulse" size={24} /></div></div><div className="space-y-2 text-center"><p className="text-sm font-bold text-white tracking-widest uppercase">Synthesizing...</p><p className="text-xs text-text-muted">Engaging Neural Engines</p></div></motion.div>
                      ) : !content ? (
                          <motion.div key="empty" initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} className="flex flex-col items-center justify-center h-full text-text-muted opacity-40"><Terminal size={48} className="mb-4 text-white/10" /><p className="text-sm">Ready to generate. Fill in the details below.</p></motion.div>
                      ) : (
                          <motion.div key="content" className="w-full h-full">{renderContent(content)}</motion.div>
                      )}
                      </AnimatePresence>
                  </div>
              ) : (
                  <div className="h-full overflow-y-auto max-h-[600px] bg-[#0B0B0D]/50 custom-scrollbar">
                      {history.length === 0 ? (<div className="flex flex-col items-center justify-center h-full text-text-muted opacity-50 p-6"><History size={32} className="mb-2 opacity-50" /><p>No history yet.</p></div>) : (<div className="divide-y divide-white/5">{history.map((item, index) => (<motion.div key={item.id} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: index * 0.05 }} className="p-5 hover:bg-white/5 transition-colors group cursor-pointer" onClick={() => { onRestore(item); setActiveTab('current'); }}><div className="flex justify-between items-start mb-2"><span className="text-xs text-text-muted font-mono bg-white/5 px-2 py-0.5 rounded">{new Date(item.timestamp).toLocaleString()}</span><div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity"><button onClick={(e) => { e.stopPropagation(); handleCopy(item.content); }} className="p-1.5 hover:bg-white/10 rounded-md text-text-muted hover:text-white" title="Copy"><Copy size={12} /></button><button onClick={(e) => { e.stopPropagation(); onRestore(item); setActiveTab('current'); }} className="p-1.5 hover:bg-white/10 rounded-md text-text-muted hover:text-primary" title="Restore inputs"><RotateCcw size={12} /></button></div></div><div className="text-sm text-gray-400 font-mono line-clamp-2 pl-1 border-l-2 border-transparent group-hover:border-primary/50 transition-colors">{item.content.length > 100 ? item.content.substring(0, 100) + '...' : item.content}</div></motion.div>))}</div>)}
                  </div>
              )}
          </div>
        </motion.div>
      </div>
    );
  };

  const ModalContent = {
    about: { title: "About Infarno", content: (<div className="space-y-12"><div className="relative rounded-3xl overflow-hidden aspect-video w-full bg-gray-900 border border-white/10 group"><img src="https://images.unsplash.com/photo-1620712943543-bcc4688e7485?q=80&w=1200&auto=format&fit=crop" alt="Future Technology" className="w-full h-full object-cover opacity-60 group-hover:scale-105 transition-transform duration-700" /><div className="absolute inset-0 bg-gradient-to-t from-[#0B0B0D] via-[#0B0B0D]/50 to-transparent flex flex-col justify-end p-8"><div className="inline-flex items-center gap-2 px-3 py-1 bg-primary/20 backdrop-blur-md rounded-full text-xs font-bold text-primary mb-3 w-fit border border-primary/20"><Flame size={12} /> EST. 2024</div><h3 className="text-4xl font-bold text-white mb-2 tracking-tight">Forging the Future</h3><p className="text-gray-300 max-w-xl text-lg font-light leading-relaxed">Infarno Tools represents the bleeding edge of accessible artificial intelligence, democratizing complex compute for the masses.</p></div></div><div className="grid md:grid-cols-2 gap-8 items-center"><div className="space-y-6"><h4 className="text-2xl font-bold text-white flex items-center gap-2"><span className="w-1 h-6 bg-primary rounded-full"></span> Our Mission</h4><p className="text-gray-400 leading-relaxed text-base">In a digital landscape fragmented by paywalls and complex APIs, Infarno stands as a beacon of accessibility.</p></div><div className="grid grid-cols-2 gap-4">{[{ icon: Globe, color: "text-blue-500", val: "190+", label: "Countries Reached" }, { icon: Zap, color: "text-yellow-500", val: "0.2s", label: "Avg Latency" }, { icon: Monitor, color: "text-purple-500", val: "2.5", label: "Gemini Version" }, { icon: Shield, color: "text-green-500", val: "100%", label: "Client Privacy" }].map((stat, i) => (<div key={i} className="bg-[#1A1A1F] p-5 rounded-2xl border border-white/5 hover:border-white/10 transition-colors"><stat.icon className={`${stat.color} mb-3`} size={28} /><div className="text-2xl font-bold text-white mb-1">{stat.val}</div><div className="text-[10px] text-gray-500 uppercase tracking-wider font-bold">{stat.label}</div></div>))}</div></div></div>) },
    faq: { title: "FAQ", content: (<div className="space-y-8"><div className="grid gap-6"><div className="flex items-center gap-3 mb-2"><HelpCircle className="text-primary" size={20} /><h4 className="text-lg font-bold text-white">General Inquiries</h4></div>{[{ q: "Is Infarno free to use?", a: "Yes. The core platform is architected as an open-access utility without mandatory subscription paywalls." }, { q: "Do I need an account?", a: "No. Your history, favorites, and settings are stored locally on your device via browser storage." }].map((item, i) => (<div key={i} className="bg-[#1A1A1F] p-6 rounded-2xl border border-white/5 hover:border-primary/30 transition-all"><h5 className="font-bold text-white mb-2 text-base">{item.q}</h5><p className="text-gray-400 text-sm leading-relaxed">{item.a}</p></div>))}</div></div>) },
    privacy: { title: "Privacy Policy", content: (<div className="space-y-8 text-gray-300"><div className="bg-gradient-to-r from-blue-900/20 to-blue-600/10 border border-blue-500/20 p-8 rounded-2xl flex flex-col md:flex-row gap-6 items-start"><div className="p-4 bg-blue-500/20 rounded-2xl shrink-0 text-blue-400"><Shield size={32} /></div><div><h4 className="text-blue-100 font-bold text-xl mb-2">Zero-Retention Philosophy</h4><p className="text-blue-200/70 text-sm leading-relaxed">We do not sell, trade, or persist your personal data.</p></div></div></div>) },
    terms: { title: "Terms of Use", content: (<div className="space-y-8 text-gray-300 text-sm"><p className="text-lg leading-relaxed border-l-4 border-primary pl-4">By accessing Infarno Tools, you agree to stipulations designed to preserve platform integrity and user safety.</p></div>) },
    contact: { title: "Contact Us", content: (<div className="space-y-8 text-center py-4"><a href="mailto:Kumararjun91609@gmail.com" className="block bg-[#151518] hover:bg-[#1A1A1F] border border-white/10 hover:border-primary/50 rounded-2xl p-10 transition-all group"><div className="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-primary/20 transition-colors"><Mail size={32} className="text-white group-hover:text-primary transition-colors" /></div><span className="font-bold text-white text-2xl block mb-2">Email Support</span><span className="text-text-muted text-base break-all">Kumararjun91609@gmail.com</span></a></div>) },
    support: { title: "Support Center", content: (<div className="space-y-6"><div className="grid gap-4">{[{ icon: HelpCircle, color: "text-blue-400", bg: "bg-blue-500/10", title: "Documentation", desc: "Guides and tutorials." }, { icon: Shield, color: "text-red-400", bg: "bg-red-500/10", title: "Bug Report", desc: "Found a glitch?" }].map((item, i) => (<div key={i} className="p-5 rounded-xl bg-[#151518] border border-white/5 hover:border-white/20 transition-all flex items-center justify-between cursor-pointer group hover:bg-[#1A1A1F]"><div className="flex items-center gap-5"><div className={`w-12 h-12 rounded-xl ${item.bg} flex items-center justify-center ${item.color}`}><item.icon size={24}/></div><div><span className="text-white font-bold text-base block mb-0.5 group-hover:text-primary transition-colors">{item.title}</span><span className="text-xs text-gray-500">{item.desc}</span></div></div><ArrowRight size={18} className="text-gray-600 group-hover:translate-x-1 transition-transform" /></div>))}</div></div>) },
    roadmap: { title: "Roadmap", content: (<div className="space-y-8 pl-2">{[{ phase: "Phase 1: Genesis", status: "Executed", color: "bg-green-500", items: ["Core Platform Architecture", "Gemini 2.5 Integration"] }, { phase: "Phase 2: Expansion", status: "Active", color: "bg-blue-500", items: ["Cloud Sync", "Collab Workspaces"] }].map((phase, i) => (<div key={i} className="relative pl-8 border-l-2 border-white/10 pb-4 last:pb-0"><div className={`absolute -left-[9px] top-0 w-4 h-4 rounded-full border-2 border-[#0B0B0D] ${phase.color} shadow-[0_0_10px_currentColor]`}></div><div className="flex items-center justify-between mb-3"><h4 className="font-bold text-white text-lg">{phase.phase}</h4></div></div>))}</div>) },
    changelog: { title: "Changelog", content: (<div className="space-y-8"><div className="bg-[#151518] p-6 rounded-2xl border border-white/5 relative overflow-hidden"><div className="flex items-baseline justify-between mb-6 relative z-10"><div><h3 className="text-white font-bold text-3xl">v1.0.0</h3><div className="text-gray-500 text-xs mt-1">Released October 2024</div></div><span className="text-xs text-primary font-bold font-mono bg-primary/10 border border-primary/20 px-3 py-1.5 rounded-full uppercase tracking-wider">Current Build</span></div></div></div>) }
  };

  const Footer = ({ onOpenDonation }) => {
    const [activeModal, setActiveModal] = useState(null);
    useEffect(() => { document.body.style.overflow = activeModal ? 'hidden' : 'unset'; return () => { document.body.style.overflow = 'unset'; }; }, [activeModal]);
    const LINKS = [{ id: 'about', label: 'About Us' }, { id: 'faq', label: 'FAQ' }, { id: 'privacy', label: 'Privacy Policy' }, { id: 'terms', label: 'Terms of Use' }, { id: 'contact', label: 'Contact' }, { id: 'support', label: 'Support' }, { id: 'changelog', label: 'Changelog' }, { id: 'roadmap', label: 'Roadmap' }];
    return (
      <>
        <footer className="relative z-10 py-16 border-t border-white/5 bg-[#0B0B0D]">
          <div className="max-w-7xl mx-auto px-6">
            <div className="mb-16 flex flex-col md:flex-row items-center justify-between bg-gradient-to-r from-white/5 to-transparent rounded-2xl p-6 border border-white/5">
              <div className="flex items-center gap-4 mb-4 md:mb-0"><div className="p-3 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-xl"><Heart className="text-pink-400 fill-pink-400" size={24} /></div><div><h3 className="text-lg font-bold text-white">Support the Platform</h3><p className="text-sm text-gray-400">Donations help us keep the tools free and build new features.</p></div></div>
              <button onClick={onOpenDonation} className="px-6 py-2.5 rounded-xl bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 text-white font-bold text-sm transition-all flex items-center gap-2 group shadow-[0_0_20px_rgba(168,85,247,0.3)] hover:shadow-[0_0_30px_rgba(168,85,247,0.6)] hover:scale-105 hover:opacity-100">Donate Now <Heart size={14} className="text-pink-200 fill-pink-200 group-hover:scale-110 transition-transform" /></button>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-4 lg:flex lg:justify-center lg:flex-wrap gap-x-12 gap-y-6 text-center">{LINKS.map((link) => (<button key={link.id} onClick={() => setActiveModal(link.id)} className="text-sm text-text-muted hover:text-white transition-all py-1 relative group">{link.label}<span className="absolute -bottom-1 left-0 w-0 h-px bg-primary transition-all duration-300 group-hover:w-full"></span></button>))}</div>
            <div className="mt-12 pt-8 border-t border-white/5 flex flex-col items-center justify-center gap-4"><div className="flex items-center gap-2 opacity-50"><Flame size={16} /><span className="text-sm font-bold tracking-tight">Infarno Tools</span></div><p className="text-text-muted/40 text-xs">&copy; {new Date().getFullYear()} Open Source Platform. Built with React & Gemini.</p></div>
          </div>
        </footer>
        <AnimatePresence>
          {activeModal && ModalContent[activeModal] && (
            <>
              <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={() => setActiveModal(null)} className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100]" />
              <div className="fixed inset-0 z-[101] flex items-end sm:items-center justify-center pointer-events-none p-0 sm:p-4">
                <motion.div initial={{ y: "100%", opacity: 0 }} animate={{ y: 0, opacity: 1 }} exit={{ y: "100%", opacity: 0 }} transition={{ type: "spring", damping: 30, stiffness: 300 }} className="w-full h-full sm:h-auto sm:max-h-[85vh] sm:max-w-5xl bg-[#151518] sm:border border-white/10 sm:rounded-2xl shadow-2xl flex flex-col pointer-events-auto overflow-hidden">
                   <div className="flex items-center justify-between px-6 py-4 border-b border-white/10 bg-[#151518] shrink-0"><h2 className="text-lg font-bold text-white">{ModalContent[activeModal].title}</h2><button onClick={() => setActiveModal(null)} className="p-2 -mr-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white"><X size={20} /></button></div>
                   <div className="flex-1 overflow-y-auto p-6 sm:p-8 custom-scrollbar bg-[#0B0B0D]">{ModalContent[activeModal].content}</div>
                </motion.div>
              </div>
            </>
          )}
        </AnimatePresence>
      </>
    );
  };

  // --- PAGES ---
  const Dashboard = () => {
    const [searchTerm, setSearchTerm] = useState('');
    const [activeCategory, setActiveCategory] = useState('All');
    const { favorites, recentTools } = useUser();
    const categories = ['All', ...Object.values(ToolCategory)];
    const filteredTools = TOOLS.filter(tool => {
      const matchesSearch = tool.name.toLowerCase().includes(searchTerm.toLowerCase()) || tool.description.toLowerCase().includes(searchTerm.toLowerCase()) || tool.tagline.toLowerCase().includes(searchTerm.toLowerCase());
      const matchesCategory = activeCategory === 'All' || tool.category === activeCategory;
      return matchesSearch && matchesCategory;
    });
    const favoriteToolsList = TOOLS.filter(t => favorites.includes(t.id));
    const recentToolsList = recentTools.map(id => TOOLS.find(t => t.id === id)).filter(Boolean);
    const containerVariants = { hidden: { opacity: 0 }, visible: { opacity: 1, transition: { staggerChildren: 0.05, delayChildren: 0.1 } } };
    const sectionVariants = { hidden: { opacity: 0, y: 20 }, visible: { opacity: 1, y: 0, transition: { duration: 0.5, ease: "easeOut" } } };

    return (
      <div className="relative min-h-screen pt-12 pb-24 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto z-10">
        <motion.div initial={{ opacity: 0, y: -30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8, ease: "easeOut" }} className="text-center mb-12 space-y-6">
          <h1 className="text-5xl sm:text-7xl font-bold tracking-tight text-white mb-4 bg-clip-text text-transparent bg-gradient-to-b from-white to-white/60 drop-shadow-lg">Dashboard</h1>
          <p className="text-lg text-text-muted max-w-2xl mx-auto font-light">Select a tool from the categories below to start generating content. Powered by next-gen AI.</p>
          <div className="max-w-xl mx-auto relative group z-20">
            <div className="absolute inset-0 bg-gradient-to-r from-primary to-secondary rounded-full opacity-20 blur-md group-hover:opacity-30 transition-opacity duration-500 animate-pulse-slow"></div>
            <div className="relative flex items-center bg-[#151518] border border-white/10 rounded-full px-6 py-4 shadow-2xl focus-within:border-primary/50 transition-colors">
              <Search className="w-5 h-5 text-text-muted mr-3" />
              <input type="text" placeholder="Search tools..." className="w-full bg-transparent text-white placeholder-text-muted/50 outline-none text-base" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
            </div>
          </div>
        </motion.div>
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }} className="flex flex-wrap justify-center gap-2 mb-16">
          {categories.map((cat) => (<button key={cat} onClick={() => setActiveCategory(cat)} className={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 border relative overflow-hidden group ${activeCategory === cat ? 'bg-white/10 border-primary/50 text-white shadow-[0_0_15px_rgba(168,85,247,0.3)]' : 'bg-transparent border-transparent text-text-muted hover:bg-white/5 hover:text-white'}`}><span className="relative z-10">{cat}</span>{activeCategory === cat && (<div className="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20 blur-sm"></div>)}</button>))}
        </motion.div>
        <AnimatePresence>{!searchTerm && activeCategory === 'All' && favoriteToolsList.length > 0 && (<motion.div initial="hidden" animate="visible" exit="hidden" variants={sectionVariants} className="mb-12"><div className="flex items-center gap-2 mb-4 px-1"><Heart size={16} className="text-red-400 fill-red-400" /><h2 className="text-sm font-bold uppercase tracking-wider text-text-muted">Favorites</h2></div><motion.div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" variants={containerVariants}>{favoriteToolsList.map((tool) => (<ToolCard key={tool.id} tool={tool} />))}</motion.div></motion.div>)}</AnimatePresence>
        <AnimatePresence>{!searchTerm && activeCategory === 'All' && recentToolsList.length > 0 && (<motion.div initial="hidden" animate="visible" exit="hidden" variants={sectionVariants} className="mb-12"><div className="flex items-center gap-2 mb-4 px-1"><Clock size={16} className="text-blue-400" /><h2 className="text-sm font-bold uppercase tracking-wider text-text-muted">Recently Used</h2></div><motion.div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" variants={containerVariants}>{recentToolsList.map((tool) => (<ToolCard key={tool.id} tool={tool} />))}</motion.div></motion.div>)}</AnimatePresence>
        {(!searchTerm && activeCategory === 'All' && (favoriteToolsList.length > 0 || recentToolsList.length > 0)) && (<div className="flex items-center gap-2 mb-4 px-1 border-t border-white/5 pt-8"><h2 className="text-sm font-bold uppercase tracking-wider text-text-muted">All Tools</h2></div>)}
        <motion.div variants={containerVariants} initial="hidden" animate="visible" className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-fr">
          <AnimatePresence mode='popLayout'>
          {filteredTools.length > 0 ? (filteredTools.map((tool) => (<ToolCard key={tool.id} tool={tool} />))) : (<motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="col-span-full text-center py-20 text-text-muted"><p>No tools found matching "{searchTerm}"</p></motion.div>)}
          </AnimatePresence>
        </motion.div>
      </div>
    );
  };

  const ToolPage = () => {
    const { id } = useParams();
    const tool = TOOLS.find(t => t.id === id);
    const { xp, addXp, favorites, toggleFavorite, addRecent, history, addToHistory, clearHistory } = useUser();
    const { showToast } = useToast();
    const [inputValues, setInputValues] = useState({});
    const [output, setOutput] = useState("");
    const [isGenerating, setIsGenerating] = useState(false);
    const [error, setError] = useState(null);
    const outputRef = useRef(null);

    useEffect(() => {
      if (tool) {
        const defaults = {};
        tool.inputs.forEach(input => { if (input.defaultValue) defaults[input.id] = input.defaultValue; });
        setInputValues(defaults); setOutput(""); setError(null);
      }
    }, [tool]);

    if (!tool) return (<div className="flex items-center justify-center min-h-screen text-white">Tool not found. <Link to="/" className="text-primary ml-2 underline">Go back</Link></div>);
    const isFavorite = favorites.includes(tool.id);
    const toolHistory = history[tool.id] || [];
    const handleInputChange = (inputId, value) => setInputValues(prev => ({ ...prev, [inputId]: value }));
    const handleFileChange = (inputId, e) => { const file = e.target.files?.[0]; if (file) { const reader = new FileReader(); reader.onloadend = () => { handleInputChange(inputId, reader.result); }; reader.readAsDataURL(file); } };
    const handleGenerate = async () => {
      setIsGenerating(true); setError(null);
      const emptyFields = tool.inputs.filter(i => !inputValues[i.id] && !i.defaultValue && i.type !== InputType.FILE);
      if (emptyFields.length > 0) { setError(`Please fill in: ${emptyFields.map(f => f.label).join(', ')}`); setIsGenerating(false); return; }
      try {
        let result = "";
        if (tool.customHandler) result = await tool.customHandler(inputValues);
        else if (tool.promptTemplate) { const prompt = tool.promptTemplate(inputValues); result = await generateContent('gemini-2.5-flash', prompt, tool.systemInstruction); }
        else throw new Error("Misconfigured tool: No handler.");
        setOutput(result); addXp(15); addRecent(tool.id); addToHistory(tool.id, { id: Date.now().toString(), content: result, timestamp: Date.now(), inputs: { ...inputValues } }); showToast("Generated successfully!", "success");
        setTimeout(() => { outputRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
      } catch (e) { setError(e.message || "Failed to generate content."); showToast("Generation failed", "error"); } finally { setIsGenerating(false); }
    };
    const restoreHistory = (item) => { setOutput(item.content); setInputValues(item.inputs); showToast("History item restored", "info"); outputRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' }); };

    return (
      <div className="relative min-h-screen pt-8 pb-20 px-4 sm:px-6 lg:px-8 max-w-5xl mx-auto z-10">
        <motion.nav initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} className="flex items-center text-sm text-text-muted mb-8 space-x-2"><Link to="/" className="hover:text-white transition-colors">Dashboard</Link><ChevronRight size={14} /><span className="text-white/50">{tool.category}</span><ChevronRight size={14} /><span className="text-white font-medium">{tool.name}</span></motion.nav>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="mb-12 flex items-start justify-between"><div className="flex items-center gap-4"><div className="p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-secondary/20 border border-white/10 shadow-lg shadow-primary/10"><tool.icon className="w-8 h-8 text-white" /></div><div><h1 className="text-3xl md:text-4xl font-bold text-white">{tool.name}</h1><p className="text-text-muted mt-1">{tool.description}</p></div></div><motion.button whileHover={{ scale: 1.1, rotate: 5 }} whileTap={{ scale: 0.9 }} onClick={() => { toggleFavorite(tool.id); showToast(isFavorite ? "Removed from favorites" : "Added to favorites", "info"); }} className="p-3 rounded-full bg-white/5 hover:bg-white/10 transition-all border border-white/5 group"><Heart className={`w-6 h-6 transition-all ${isFavorite ? 'text-red-500 fill-red-500' : 'text-text-muted group-hover:text-red-400'}`} /></motion.button></motion.div>
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
          <motion.div initial={{ opacity: 0, x: -50 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2, duration: 0.5 }} className="lg:col-span-5 order-2 lg:order-1 space-y-8">
              <div className="glass-panel rounded-2xl p-6 md:p-8 border border-white/10 relative overflow-hidden">
                  <div className="absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full blur-3xl -z-10"></div>
                  <h2 className="text-xl font-semibold text-white mb-6 flex items-center gap-2">Enter Details<div className="h-px flex-1 bg-white/10 ml-4"></div></h2>
                  <div className="space-y-6">
                      {tool.inputs.map(input => (
                          <div key={input.id} className="space-y-2">
                              <label className="block text-sm font-medium text-gray-300">{input.label}</label>
                              {input.type === InputType.TEXTAREA ? (<textarea className="w-full bg-[#0B0B0D]/80 border border-white/10 rounded-xl p-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all min-h-[120px] resize-y" placeholder={input.placeholder} value={inputValues[input.id] || ''} onChange={(e) => handleInputChange(input.id, e.target.value)} />) : input.type === InputType.SELECT ? (<div className="relative"><select className="w-full bg-[#0B0B0D]/80 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-primary/50 appearance-none" value={inputValues[input.id] || ''} onChange={(e) => handleInputChange(input.id, e.target.value)}>{input.options?.map(opt => (<option key={opt} value={opt}>{opt}</option>))}</select><div className="absolute right-3 top-3.5 pointer-events-none text-gray-500"><ChevronRight size={16} className="rotate-90" /></div></div>) : input.type === InputType.FILE ? (<div className="relative group"><input type="file" accept={input.accept} onChange={(e) => handleFileChange(input.id, e)} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" /><div className="w-full bg-[#0B0B0D]/80 border border-dashed border-white/20 rounded-xl p-6 text-center group-hover:border-primary/50 group-hover:bg-primary/5 transition-all flex flex-col items-center gap-2"><Upload className="text-text-muted group-hover:text-primary transition-colors" /><span className="text-sm text-text-muted">{inputValues[input.id] ? "File selected (Click to change)" : "Click to upload file"}</span></div></div>) : (<input type={input.type === InputType.NUMBER ? 'number' : 'text'} className="w-full bg-[#0B0B0D]/80 border border-white/10 rounded-xl p-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 transition-all" placeholder={input.placeholder} value={inputValues[input.id] || ''} onChange={(e) => handleInputChange(input.id, e.target.value)} />)}
                          </div>
                      ))}
                  </div>
                  {error && (<motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-200 text-sm flex items-start gap-2"><AlertCircle size={16} className="mt-0.5 shrink-0" />{error}</motion.div>)}
                  <div className="mt-8">
                      <motion.button onClick={handleGenerate} disabled={isGenerating} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="relative w-full group overflow-hidden rounded-xl p-[1px] focus:outline-none">
                          <div className="absolute inset-0 bg-gradient-to-r from-primary via-white/50 to-primary bg-size-200 animate-shimmer opacity-0 group-hover:opacity-100 transition-opacity"></div><div className="absolute inset-0 bg-gradient-to-r from-primary to-secondary opacity-80 group-hover:opacity-100 transition-opacity" />
                          <div className="relative bg-[#1A1A1D] group-hover:bg-opacity-0 rounded-xl px-6 py-4 flex items-center justify-center gap-3 transition-all duration-300">
                              {isGenerating ? (<><div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" /><span className="text-white font-semibold group-hover:text-white">Processing...</span></>) : (<><Wand2 className="w-5 h-5 text-white" /><span className="text-white font-semibold text-lg">Generate Magic</span></>)}
                          </div>
                      </motion.button>
                  </div>
              </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 50 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }} className="lg:col-span-7 order-1 lg:order-2" ref={outputRef}><div className="sticky top-24 space-y-6"><OutputSection content={output} isGenerating={isGenerating} history={toolHistory} onRestore={restoreHistory} onClear={() => { clearHistory(tool.id); showToast("History cleared", "info"); }} /></div></motion.div>
        </div>
      </div>
    );
  };

  // Static Pages
  const PageLayout = ({ children }) => (<motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className="min-h-screen pt-24 pb-20 px-4 sm:px-6 lg:px-8 max-w-5xl mx-auto relative z-10"><Link to="/" className="inline-flex items-center gap-2 text-sm text-text-muted hover:text-white transition-colors mb-8 group"><ChevronLeft size={16} className="group-hover:-translate-x-1 transition-transform" />Return to Dashboard</Link>{children}</motion.div>);
  const PageHeader = ({ title, subtitle, icon }) => (<div className="text-center space-y-6 py-12 border-b border-white/5 relative overflow-hidden"><div className="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-primary/10 blur-[100px] rounded-full pointer-events-none"></div>{icon && (<div className="inline-flex items-center justify-center p-4 rounded-2xl bg-white/5 border border-white/10 mb-4 relative z-10">{icon}</div>)}<h1 className="text-4xl md:text-6xl font-bold text-white tracking-tight relative z-10">{title}</h1><p className="text-lg md:text-xl text-text-muted max-w-2xl mx-auto font-light leading-relaxed relative z-10">{subtitle}</p></div>);
  
  const AboutPage = () => (<PageLayout><PageHeader title="About Infarno" subtitle="Architecting the convergence of advanced Generative Artificial Intelligence and utilitarian pragmatism." icon={<Flame size={40} className="text-primary" />} /><div className="mt-12 text-gray-300 text-lg">Detailed information about Infarno Tools...</div></PageLayout>);
  const SupportPage = () => (<PageLayout><PageHeader title="Support Center" subtitle="We are here to help." icon={<Zap size={40} className="text-yellow-400" />} /><div className="mt-12 text-gray-300">Support content...</div></PageLayout>);
  const ContactPage = () => (<PageLayout><PageHeader title="Contact Us" subtitle="Get in touch with the team." icon={<Mail size={40} className="text-primary" />} /><div className="mt-12 text-gray-300">Contact forms and details...</div></PageLayout>);
  // (Simplified Static Pages for brevity in single file, actual content would be rendered here)

  // --- APP ---
  const ScrollToTop = () => { const { pathname } = useLocation(); useEffect(() => { window.scrollTo(0, 0); }, [pathname]); return null; };

  const App = () => {
    const [isDonationOpen, setIsDonationOpen] = useState(false);
    useEffect(() => {
      const hasSeen = localStorage.getItem('infarno_donation_seen');
      if (!hasSeen) {
        const timer = setTimeout(() => { setIsDonationOpen(true); localStorage.setItem('infarno_donation_seen', 'true'); }, 40000); 
        return () => clearTimeout(timer);
      }
    }, []);

    return (
      <UserProvider>
        <ToastProvider>
          <HashRouter>
            <ScrollToTop />
            <div className="min-h-screen relative flex flex-col font-sans text-text-main selection:bg-primary/30 selection:text-white">
              <FloatingBackground />
              <Navbar />
              <main className="flex-grow w-full relative">
                <Routes>
                  <Route path="/" element={<Dashboard />} />
                  <Route path="/tool/:id" element={<ToolPage />} />
                  <Route path="/about" element={<AboutPage />} />
                  <Route path="/support" element={<SupportPage />} />
                  <Route path="/contact" element={<ContactPage />} />
                  {/* Add other static routes as needed */}
                </Routes>
              </main>
              <Footer onOpenDonation={() => setIsDonationOpen(true)} />
              <DonationModal isOpen={isDonationOpen} onClose={() => setIsDonationOpen(false)} />
            </div>
          </HashRouter>
        </ToastProvider>
      </UserProvider>
    );
  };

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(
    <React.StrictMode>
      <ErrorBoundary>
        <App />
      </ErrorBoundary>
    </React.StrictMode>
  );
</script>
</body>
</html>